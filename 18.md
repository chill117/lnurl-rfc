LUD-18: Payer identity in `payRequest` protocol.
================================================

`author: akumaigorodski`

---

## Specifying payer identity before sending a payment

Payer MAY attach a `payerid` query parameter to LNURL-PAY callback with value set to `base64`-encoded JSON array:

```diff
- <callback><?|&>amount=<milliSatoshi>
+ <callback><?|&>amount=<milliSatoshi>&payerid=<base64(<array of identity objects>)>
```

JSON array may contain one or more objects of the following forms:

1. `{ tag: "text/plain", sender: <free-form string> }`
2. `{ tag: "application/pubkey", pubkey: hex(<randomly generated pubkey>) }`
3. `{ tag: "application/lnurl-auth", pubkey: hex(<linkingKey>), sig: hex(sign(utf8ToBytes(<k1>), <linkingPrivKey>)) }`
4. `{ tag: "text/identifier", sender: <internet identifier> }`
5. `{ tag: "text/email", sender: <email address> }`

If present, JSON array MAY NOT contain more than one object with the same tag as well as `text/identifier` and `text/email` objects at once.

## `LNURL-AUTH` integration specifics

If `LN SERVICE` wants to allow an `LN WALLET` to provide `LNURL-AUTH` signature and `linkingKey` it MUST supply the following additional `metadata` record in its JSON response:

```
[
  ...,
  [
    "application/lnurl-auth", 
    isMandatory, // boolean which flags if user MAY include `application/lnurl-auth` object in callback or MUST do that
    k1 // hex encoded 32 bytes of challenge
  ],
]
```

Upon seeing an optional `LNURL-AUTH` record in metadata user SHOULD be given an option to attach an `LNURL-AUTH` object in callback.

Upon seeing a mandatory `LNURL-AUTH` record in metadata user MUST be informed by `LN WALLET` that callback will have an `LNURL-AUTH` object.

Domain name used for generation of `linkingKey` MUST be the one seen in `LNURL-PAY` static link.
